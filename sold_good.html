<!DOCTYPE html>
<html>
<head>
    <title>Hayler Dashboards</title>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather&family=Montserrat:wght@200;300&family=Ubuntu:wght@500&display=swap" rel="stylesheet">

    <link href="main_style_components.css" rel="stylesheet">
</head>

<body>




<input type="date" id="dateSince">
<input type="date" id="dateTo">

<br>
<form id="radio">

    <p>Результаты за:</p>

    <div class="options_style">
        <div>
            <input type="radio" name="size" class="text" value="month" id="button_radio">
            <label for="s">Месяц</label>
        </div>
        <div>
            <input type="radio" name="size" class="text" value="week" id="button_radio">
            <label for="m">Неделя</label>
        </div>
        <div>
            <input type="radio" name="size" class="text" value="day" id="button_radio">
            <label for="l">День</label>
        </div>
    </div>
</form>

<br>
<div class="block_buttons">

    <div class="buttons">
        <div>
            <button nonce="32rd24"  id="search_button">Показать данные</button>

            <button id="delete_button" onclick="clear_data()">Очистить данные</button>
        </div>



    </div>

    <p id="output"></p>




</div>
<p class="title_of_canvas">Количество продаж</p>
<p>v1.0.1</p>

</div>








        <p id="r_seven"></p>
        <h2 id="result_six"></h2>
        <canvas class="cv" width="100px" height="25px" id="sixth"></canvas>



<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="tools.js"></script>

<script src="auxiliary_tools.js"></script>

<script src="sold_good_component.js"></script>
<script>

    let token = "Aak6Fwm000Sc-78309-LLgrz63bbD5-098Vvewlkvi";

    //{"HTTPService":"H5cnysFppEwVb9412*ff20#98243@"}


    //HTTPService:H5cnysFppEwVb9412*ff2098243@
    document.getElementById("search_button").onclick = function(){
        start_process();
    }



    week = 0;
    counter = 0;
    //form data id="radio"
    var form = document.querySelector("#radio");
    var array_of_names  = [];
    var result_of_month ;

    // seventh sold goood
    var seventh_names = [" ", " " , " "];
    var seventh_days_line_y = [0,0,0];
    var array_of_company_revenue_seventh = [0,0,0];
    var result_of_average_check;
    var array_of_names_year = [];
    let array_of_revenues__ = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var  result_of_year;
    //number of sales

    // brand per year
    //var name = document.getElementById("s1").value;
    var array_of_labels = ["Январь" , "Февраль" , "Март" , "Апрель" , "Май" , "Июнь" , "Июль" , "Август" , "Сентябрь" , "Октябрь" , "Ноябрь" ,"Декабрь"];
    let array_of_revenue = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
    var type_of_date; //month , week , day ;
    var date_for_data = " " ;

    //consumtions data
    var consumptions_names = [];
    var consumptions_result = create_array_of_revenues();

    // calculate data for brand

    async function process_data_for_brand( type_of_date  , dateSince , dateTo){



        console.log(type_of_date);
        if(type_of_date == "month"){
            //var name = document.getElementById("goods");
            //console.log(name.value)

            Process_data_sold_good(dateSince , dateTo , seventh_names , type_of_date ,name)


            //get_number_of_sales_companies(second_names,array_of_company_revenue_second ,"month");
            //get_number_of_trading_profit(fourth_names , array_of_company_revenue_fourth , "month" );
            //get_data_about_average_check(fith_names,array_of_company_revenue_fith,"month");

            //get_data_about_consumptions(third_names , array_of_company_revenue_third , "month");
            //setTimeout(Create_chart_consumptions,2000);
            //setTimeout(Create_chart_average_check,2500);

            //etTimeout(Create_chart_trade_revenue,2000)
            //setTimeout(Create_chart_trading_profit,2000)


        }
        if(type_of_date == "week"){
            //var name = document.getElementById("goods");
            //console.log(name.value)
            Process_data_sold_good_week(dateSince , dateTo , seventh_days_line_y , "week" )

            //get_number_of_sales_companies(second_names,array_of_company_revenue_second ,"week");
            //get_number_of_trading_profit(fourth_names , array_of_company_revenue_fourth , "week");
            //get_data_about_average_check(fith_names,array_of_company_revenue_fith,"week");

            //get_data_about_consumptions(third_names , array_of_company_revenue_third , "week");
            //setTimeout(Create_chart_consumptions ,2000);
            //setTimeout(Create_chart_average_check,1500);

            //setTimeout(Create_chart_trade_revenue,1000)
            //setTimeout(Create_chart_trading_profit,1000)
            //setTimeout(Create_chart(type_of_date),1000);


        }

        if(type_of_date == "day"){
            //var name = document.getElementById("goods");
            //console.log(name.value)

            Process_data_sold_good_per_day(dateSince , dateTo ,seventh_days_line_y,"day");

            //get_number_of_sales_companies(second_names,array_of_company_revenue_second ,"day");
            //get_number_of_trading_profit(fourth_names , array_of_company_revenue_fourth , "day");
            //get_data_about_average_check(fith_names,array_of_company_revenue_fith,"day");
            //setTimeout(Create_chart_consumptions ,2000);
            //setTimeout(Create_chart_average_check,1500);

            //setTimeout(Create_chart_trade_revenue,1000)
            //setTimeout(Create_chart_trading_profit,1000)



        }

    }



    function Create_chart_sold_good_per_days(){
        console.log("Result of expenses:",seventh_days_line_y);
        const data = {
            labels: seventh_days_line_y,

            datasets: [ {
                type: 'line',
                label: 'проданный товар',
                data: array_of_company_revenue_seventh,
                fill: false,
                borderColor: 'rgb(255,144, 0)'
            }]
        };

        const config = {
            type: 'scatter',
            data: data,
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                layout: {
                    padding:0
                }
            }
        };

        var result_of_consumption = 0;

        result_of_consumption= summ_of_array(array_of_company_revenue_seventh);
        console.log(result_of_consumption)
        window.myChart_sold_good = new Chart(
            document.getElementById('sixth'),
            config
        );

        result_of_consumption = Math.round(result_of_consumption);
        document.getElementById("result_six").innerHTML = result_of_consumption;

    }

    function Create_chart_sold_good(){
        console.log("Result of expenses:",seventh_names);
        const data = {
            labels: second_names,

            datasets: [ {
                type: 'line',
                label: 'проданный товар',
                data: array_of_company_revenue_seventh,
                fill: false,
                borderColor: 'rgb(255, 144, 0)'
            }]
        };

        const config = {
            type: 'scatter',
            data: data,
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                layout: {
                    padding:0
                }
            }
        };

        var result_of_consumption = 0;

        result_of_consumption= summ_of_array(array_of_company_revenue_seventh);
        console.log(result_of_consumption)
        window.myChart_sold_good = new Chart(
            document.getElementById('sixth'),
            config
        );

        // round  number to closer int number
        result_of_consumption = Math.round(result_of_consumption);
        document.getElementById("result_six").innerHTML = "Всего:"+result_of_consumption;

    }

    //clear and destroy chart
    function clear_data(){
        //clear data about results

        document.getElementById("result_six").innerHTML = " ";
        //clear data in arraies

        array_of_company_revenue_seventh.length = 0;

        seventh_days_line_y = 0 ;

        names.length = 0;
        week = 0 ;
        //fill array to avoid  "Na"
        //third_names = [0,0,0,0,0,0,0,0,0,0,0,0,0,0];
        names = [" " , " " , " " , " " , " " , " "];

        seventh_days_line_y =create_array_of_revenues()



        array_of_company_revenue_seventh = create_array_of_revenues()


        myChart_sold_good.destroy();
    }

    //start of algorithm
    async function start_process()
    {
        //select  interval
        var data = new FormData(form);
        var output = "";
        for (const entry of data) {
            output =  entry[1];
        };


        var dateSince = document.getElementById("dateSince").value;
        var dateTo = document.getElementById("dateTo").value;
        console.log("dateSince:" , dateSince , "dateTo:",dateTo);
        //await console.log(selectedOption);
        // var name = document.getElementById("s1").value;



        process_data_for_brand(output , dateSince , dateTo);
        //setTimeout(Create_chart_for_company,2000);
    }







</script>
</body>
</html>